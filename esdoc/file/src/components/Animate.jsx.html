<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/components/Animate.jsx | reactD3 components API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Animate.jsx~Animate.html">Animate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Circles.jsx~Circles.html">Circles</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Ellipses.jsx~Ellipses.html">Ellipses</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Lines.jsx~Lines.html">Lines</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Paths.jsx~Paths.html">Paths</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Rectangles.jsx~Rectangles.html">Rectangles</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Texts.jsx~Texts.html">Texts</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/components/Animate.jsx</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { Component, PropTypes, cloneElement, unmountComponentAtNode, findDOMNode } from &apos;react&apos;;
import { ease } from &apos;d3&apos;;

window.requestAnimationFrame = window.requestAnimationFrame ||
 window.mozRequestAnimationFrame ||
  window.webkitRequestAnimationFrame ||
   window.msRequestAnimationFrame;

export default class Animate extends Component {

    constructor(props) {
        super(props);
        this.state = {
            timer: 0
        };
    }

    componentWillMount() {
        this._start();
    }

    componentWillReceiveProps() {
        this._start();
    }

    _nestedDefaultProps(propToMerge, defaultProp) {
        if (this.props[propToMerge].length &gt; 0) {
            for (let [propObjectToMerge, propObjectContent] of this.props[propToMerge].entries()) {
                this.props[propToMerge][propObjectToMerge] = Object.assign({}, defaultProp, propObjectContent);
            };
        }
    }

    _start() {
        this._nestedDefaultProps(&apos;attributes&apos;, {from: 0, ease: &apos;linear&apos;});
        this._nestedDefaultProps(&apos;style&apos;, {from: 0, ease: &apos;linear&apos;});
        this._nestedDefaultProps(&apos;transformations&apos;, {from: 0, ease: &apos;linear&apos;});
        this.startTime = Date.now();
        window.requestAnimationFrame(this._tick.bind(this));
    }

    _tick() {
        if (this.props) {
            if (this.state.timer &lt; (this.props.duration + this.props.delay * this.props.children.props[this.props.childrenPropsToAnimate].length)) {
                this.setState({
                    timer: Date.now() - this.startTime
                });
                window.requestAnimationFrame(this._tick.bind(this));
            }
        }
    }

    _animateElement(elementAttributes, elementIndex) {
        const elementCanStartAnimation = this.state.timer - (this.props.delay * elementIndex) &gt;= 0;
        const elementAnimationProgression = (this.state.timer - this.props.delay * elementIndex) / this.props.duration;
        let transform = &apos;&apos;;

        if (elementCanStartAnimation) {

            // Animate by changing progressively the attributes
            for (let [, attributeToChange] of this.props.attributes.entries()) {
                elementAttributes[attributeToChange.name] = attributeToChange.from +
                (attributeToChange.to(elementAttributes, elementIndex) - attributeToChange.from) *
                 ease(attributeToChange.ease)(elementAnimationProgression);
            }

            // Animate by executing transformations
            for (let [, transformationsToExecute] of this.props.transformations.entries()) {
                const transformationProperty = transformationsToExecute.from +
                (transformationsToExecute.to - transformationsToExecute.from) *
                ease(transformationsToExecute.ease)(elementAnimationProgression);
                transform += ` ${transformationsToExecute.name}(${transformationProperty})`;
            }
        } else {
            // Animate by changing progressively the attributes
            for (let [, attributeToChange] of this.props.attributes.entries()) {
                elementAttributes[attributeToChange.name] = attributeToChange.from;
            }

            // Animate by executing transformations
            for (let [, transformationsToExecute] of this.props.transformations.entries()) {
                const transformationProperty = transformationsToExecute.from;
                transform += ` ${transformationsToExecute.name}(${transformationProperty})`;
            }
        }

        elementAttributes.transform = transform; //

        // Animate Style, for now, style animation is only change at end of the timer
        if (elementAnimationProgression &gt;= 1) {
            for (let [, styleToChange] of this.props.style.entries()) {
                elementAttributes.style[styleToChange.name] = styleToChange.to;
            }
        }

        return elementAttributes;
    }

    _renderChildrens() {
        for (let [elementToAnimate, elementAttributes] of
            this.props.children.props[this.props.childrenPropsToAnimate].entries()) {
            this.props.children.props[this.props.childrenPropsToAnimate][elementToAnimate] =  this._animateElement(elementAttributes, elementToAnimate);
        }

        return cloneElement(this.props.children, this.props.children.props[this.props.childrenPropsToAnimate]);
    }

    render() {
        return this._renderChildrens();
    }
};

Animate.propTypes = {
    duration: PropTypes.number,
    delay: PropTypes.number,
    childrenPropsToAnimate: PropTypes.string,
    attributes: PropTypes.arrayOf(
        PropTypes.shape({
            name: PropTypes.string.isRequired,
            start: PropTypes.number,
            from: PropTypes.oneOfType([
                PropTypes.number,
                PropTypes.func
            ]),
            to: PropTypes.oneOfType([
                PropTypes.number,
                PropTypes.func
            ]).isRequired,
            ease: PropTypes.string
        })
    ),
    style: PropTypes.arrayOf(
        PropTypes.shape({
            name: PropTypes.string.isRequired,
        })
    ),
    transformations: PropTypes.arrayOf(PropTypes.object)
};

Animate.defaultProps = {
    wait: 0,
    duration: 800,
    delay: 0,
    childrenPropsToAnimate: &apos;&apos;,
    attributes: [],
    style: [],
    transformations: []
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.0)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
